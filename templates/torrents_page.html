{{define "navpane"}}
<!-- Curent Paths -->
<div id="navbox">
	<div class="navbox">
		<div class="navbox_title">DISKS</div>
		<div class="navbox_content">
			{{range $idx, $diskStats := .DiskStats}}
			<div class="disk_stats">
				<div><span class="bold subtitle">Path</span>{{$diskStats.Path}}</div>
				<div><span class="bold subtitle">Disk Size</span>{{$diskStats.Size}}</div>
				<div><span class="bold subtitle">Empty Space</span>{{$diskStats.Avail}}</div>
			</div>
			{{end}}
		</div>
	</div>
	<div class="navbox">
		<div class="navbox_title">QUEUE / CACHE</div>
		<div class="navbox_content">
			<div><span class="bold subtitle">Queue Elems</span>{{.MvBufferElems}}</div>
			<div><span class="bold subtitle">Queue Size</span>{{.MvBufferSize}}</div>
			<div><span class="bold subtitle">Cache refreshed</span> {{print .CacheResfreshed}}</div>
			<div>
				<form action="/cache/update">
					<input type="submit" value="Update cache">
				</form>
			</div>
		</div>
	</div>
</div>
{{end}}

{{define "section"}}
<div>
{{if .PathInfo }}
{{$stl :=  .SeriesTargets }}
<table>
  <colgroup>
		<col width="50%"><!-- Path -->
		<col width="20%" align="center"><!-- Torrent Status -->
		<col width="30%" align="center"><!-- Move Status -->
  </colgroup>
	<tr>
		<th>Path</th>
		<th>Torrent Status</th>
		<th>Move</th>
	</tr>
	{{ range $idx, $pathInfo := .PathInfo }}
  <tr>
		<!-- Path Column -->
    <td>
			<span class="torrent_name path" id="path_{{print $idx}}">â–¶ {{print $pathInfo.Path }}</span>
      {{if $pathInfo.TorrentInfo }}
			<div class="expandable" id="listing_{{print $idx}}" style="display: none">
        <ul>
        {{ range $idx, $torrentFileInfo := $pathInfo.TorrentInfo.Files }}
				<li><span class="path">{{print $torrentFileInfo.Name}}</span></li>
        {{end}}
        </ul>
      </div>
			<script>
				$(function() {
					$("#path_{{print $idx}}").click(function() {
						$("#listing_{{print $idx}}").toggle("fold", {}, 500)
					});
				});
			</script>
      {{end}}
		</td>

		<!-- Torrent Status -->
		<td>
      {{if $pathInfo.TorrentInfo }}
				{{if $pathInfo.TorrentInfo.IsFinished }}
					<span class="torrent_state darkgreen_bold">Finished</span>
					{{else}}
					<span class="torrent_state darkred_bold">Not Finished</span>
				{{end}}
			{{else}}
					<span class="torrent_state darkblue_bold">No Torrent Info</span>
      {{end}}
    </td>

		<!-- Move Form -->
    <td>
			{{if $pathInfo.MoveInfo.Moving}}
				<span class="darkblue_bold">MOVING TO</span>
				<span class="target path">{{print $pathInfo.MoveInfo.Target}}</span>
			{{else}}
			  {{if $pathInfo.MoveInfo.Error}}
					<span class="darkred_bold">Last move error: {{print $pathInfo.MoveInfo.Error}}</span>
				{{end}}
				{{if $pathInfo.AllowMove}}
				  {{if not $pathInfo.TorrentInfo}}
					  <span class="darkblue_bold">No torrent info - be careful what you move</span>
					{{end}}
					<form action="/move" method="post">
						<input type="submit" value="move">
						to
						<select name="target">
							<option value="movies">movies</option>
							{{if $stl}}
								{{range $idx, $path := $stl}}
								<option value="{{print $path}}">{{print $path}}</option>
								{{end}}
							{{end}}
						</select>
						<input type="hidden" name="path" value="{{print $pathInfo.Path}}">
						<input type="hidden" name="type" value="move">
					</form>
				{{else}}
				  {{if $pathInfo.TorrentInfo}}
						{{if $pathInfo.TorrentInfo.IsFinished}}
							<span class="darkblue_bold">Not allowed to move path but torrent is finished. ????</span>
						{{else}}
							<span class="darkblue_bold">Not allowed because torrent not finished yet.</span>
						{{end}}
					{{else}}
							<span class="darkblue_bold">Not allowed because torrent not finished yet.</span>
					{{end}}
				{{end}}
			{{end}}
    </td>
  </tr>
  {{end}}
</table>
{{end}}

<!-- History of paths -->
{{if .PathInfoHistory }}
<table>
  <colgroup>
		<col width="50%"><!-- Path -->
		<col width="20%"><!-- Torrent Status -->
		<col width="30%"><!-- Move Status -->
  </colgroup>
	<tr>
		<th>Path</th>
		<th>Torrent Status</th>
		<th>Move Target</th>
	</tr>
	{{ range $idx, $pathInfo := .PathInfoHistory }}
  <tr>
		<!-- Path Column -->
    <td>
      <span class="torrent_name path">{{print $pathInfo.Path }}</span>
      {{if $pathInfo.TorrentInfo }}
      <div>
        <ul>
        {{ range $idx, $torrentFileInfo := $pathInfo.TorrentInfo.Files }}
				<li><span class="path">{{print $torrentFileInfo.Name}}</span></li>
        {{end}}
        </ul>
      </div>
      {{end}}
		</td>

		<!-- Torrent Status -->
		<td>
      {{if $pathInfo.TorrentInfo }}
				{{if $pathInfo.TorrentInfo.IsFinished }}
					<span class="torrent_state darkgreen_bold">Finished</span>
					{{else}}
					<span class="torrent_state darkred_bold">Not Finished</span>
				{{end}}
			{{else}}
					<span class="torrent_state darkblue_bold">No Torrent Info</span>
      {{end}}
    </td>

		<!-- Move Target -->
		<td>
			<span class="darkblue_bold">{{print $pathInfo.MoveInfo.Target }}</span>
		</td>

  {{end}}
</table>
{{end}}
</div>

{{end}}
