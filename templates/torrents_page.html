{{define "navpane"}}
<!-- Curent Paths -->
<md-card>
	<md-card-title><md-card-title-text>DISKS</md-card-title-text></md-card-title>
	<md-card-content flex layout="column">
			{{range $idx, $diskStats := .DiskStats}}
			<div layout="column" style="padding-bottom: 10px;">
				<div class="bold" layout="row" layout-alignment="center end">
					<span flex>{{$diskStats.Path}}</span>
					<span>{{$diskStats.FsType}}</span>
				</div>
				<div layout="row" layout-align="center center">
					<span flex=40>{{$diskStats.Avail}} MB</span>
					<span flex=20> free of </span>
					<span flex=40>{{$diskStats.Size}} MB</span>
				</div>
				<md-progress-linear md-mode="determinate" value="{{print $diskStats.PercentFull}}"></md-progress-linear>
			</div>
			{{end}}
			<md-button ng-href="/update/disks">Update disk stats</md-button>
	</md-card-content>
</md-card>
<md-card>
	<md-card-title><md-card-title-text>STATS</md-card-title-text></md-card-title>
	<md-card-content layout="column">
		<div layout="column">
			<span><b>Queue Elements / Size</b></span>
			<span>{{.MvBufferElems}} / {{.MvBufferSize}}</span>
		</div>
		<md-divider></md-divider>
		<div layout="column">
			<span><b>Last Cache refresh</b></span>
			<span>{{.CacheResfreshed}}</span>
		</div>
		<md-button ng-href="/update/cache">Update cache</md-button>
	</md-card-content>
</md-card>
{{end}}

{{define "section"}}
<md-panel>
{{$mts :=  .MoveTargets }}
<script>
$('document').ready(function() {
	$( ".move_target_select" ).autocomplete({
		minLength: 0,
	  source: [
			{{range $idx, $path := $mts}}
			{{$path}},
			{{end}}
		]
	});
});
</script>

{{ if .PathInfo}}
<md-card>
<md-card-content>
<md-list flex layout="column" flex>
	{{ range $idx, $pathInfo := .PathInfo }}
	<md-list-item layout="row" flex>
	<md-panel layout="column" flex>
		<div layout="row">
			<!-- Path Column -->
			<div layout="column" flex>
				<span class="torrent_name path" id="path_{{$idx}}">â–¶ {{print $pathInfo.Name }}</span>
				<span ng-if="$pathInfo.Path != ''">{{$pathInfo.Path}}</span>
			</div>

			<!-- Torrent Status -->
			<div flex=10>
				{{if $pathInfo.Torrent}}
					{{if $pathInfo.Torrent.IsFinished }}
						<span class="torrent_state darkgreen_bold">Finished</span>
						{{else}}
						<span class="torrent_state darkred_bold">{{$pathInfo.PercentDone}}%</span>
					{{end}}
				{{else}}
						<span class="torrent_state darkblue_bold">Torrent info missing</span>
				{{end}}
			</div>

			<!-- Move Form -->
			<div flex=30>
			{{if $pathInfo.MoveInfo.Moving}}
				<span class="darkblue_bold">MOVING TO</span>
				<span class="target path">{{print $pathInfo.MoveInfo.Target}}</span>
			{{else}}
				{{if $pathInfo.AllowMove}}
					<div>
						{{if not $pathInfo.Torrent}}
							<span class="darkblue_bold">No torrent info - be careful what you move</span>
						{{end}}
						<form action="/move" method="post">
							<input name="target" class="move_target_select">
							<input type="hidden" name="path" value="{{print $pathInfo.Path}}">
							<input type="hidden" name="type" value="move">
							<input type="submit" value="move">
						</form>
					</div>
				{{else}}
				  <div>
				  {{if $pathInfo.Torrent}}
						{{if $pathInfo.Torrent.IsFinished}}
							<span class="darkblue_bold">Not allowed to move path but torrent is finished. ????</span>
						{{else}}
							<span class="darkblue_bold">Not allowed because torrent not finished yet.</span>
						{{end}}
					{{else}}
							<span class="darkblue_bold">Not allowed to move but no torrent info. ????</span>
					{{end}}
					</div>
				{{end}}
			{{end}}
			</div>
		</div>

		<md-progress-linear md-mode="determinate" value="{{$pathInfo.PercentDone}}"></md-progress-linear>
		{{if $pathInfo.Torrent }}
		<div class="expandable" id="listing_{{$idx}}" style="display: none">
			<ul>
			{{ range $idx, $torrentFileInfo := $pathInfo.Torrent.Files }}
			<li><span class="path">{{print $torrentFileInfo.Name}}</span></li>
			{{end}}
			</ul>
		</div>
		<script>
			$(function() {
				$("#path_{{$idx}}").click(function() {
					$("#listing_{{$idx}}").toggle("fold", {}, 500)
				});
			});
		</script>
		{{end}}
		{{if $pathInfo.MoveInfo.LastError}}
			<div><span class="darkred_bold">Last move error:</span> {{print $pathInfo.MoveInfo.LastError}}</div>
			<div>{{$pathInfo.MoveInfo.LastErrorOutput}}</div>
		{{end}}
	</md-panel>
	</md-list-item>
	<md-divider></md-divider>
  {{end}}
<md-list>
</md-card-content>
</md-card>

<md-card>
<md-card-content layout="column">
{{ range $idx, $m := .Messages }}
<div layout="row">
	<span flex="10">{{timeformat $m.T "" }}</span>
	<span flex="10">{{$m.Type}}</span>
	<span flex>{{$m.Msg}}</span>
</div>
{{end}}
</md-card-content>
</md-card>

{{end}}

{{end}}
